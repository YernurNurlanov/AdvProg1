<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Football Manager</title>
	<style>
		body {
			font-family: Arial, sans-serif;
			background-image: url('https://wallpapercave.com/wp/wp10054836.jpg');
			background-size: cover;
			background-position: center;
			background-attachment: fixed;
			margin: 0;
			padding: 20px;
			padding-top: 0px;
		}

		header {
			text-align: center;
			width: 100%;
			top: 0;
			left: 0;
			z-index: 1000;
			color: #fff;
			text-shadow: 1px 1px 8px rgba(0,0,0,0.7);
		}

		.card-container {
			display: flex;
			flex-wrap: wrap;
			justify-content: space-around;
		}

		.card {
			background-color: gold;
			border: 1px solid #ddd;
			margin: 10px;
			padding: 10px;
			width: 100px;
		}

		#filter-sort {
			margin-bottom: 20px;
		}

		#pagination {
			margin-top: 20px;
			text-align: center;
		}

		.page-link {
			margin: 0 5px;
			cursor: pointer;
		}

		.page-link.active {
			font-weight: bold;
		}
	</style>
</head>
<body>
	<header>
			<h1>Market</h1>
	</header>
	<div id="filter-sort">
			<!-- Sorting Options -->
			<form id="sortForm">
				<select id="sortCards" name="sortBy">
					<option value="">Select</option>
					<option value="name">Name</option>
					<option value="card_id">Card_id</option>
				</select>
				<input type="submit" value="Submit">
			</form>	
			<!-- Filtering Options -->
			<form id="filterForm">
				<select id="positionFilter" name="filter">
						<option value="">Select a position</option>
						<option value="Forward"> Forward</option>
						<option value="Midfielder"> Midfielder</option>
						<option value="Defender"> Defender</option>
						<option value="Goalkeeper"> Goalkeeper</option>
						<option value="Manager"> Manager</option>
				</select>
				<input type="submit" value="Submit">
		</form>		
	</div>
	<!-- Market Cards -->
	<div id="marketCards" class="card-container">
	</div>
	<!-- Pagination -->
	<div class="pagination">
			<button id="prevPage">Prev</button>
			<span id="currentPage">1</span>
			<button id="nextPage">Next</button>
	</div>

	<script>
		// display cards
		let currentPage = 1
		var page = document.getElementById("currentPage")
		let filter = document.getElementById('positionFilter').value
		let sortBy = document.getElementById('sortCards').value
		document.getElementById('prevPage').disabled = currentPage === 1;
		document.addEventListener('DOMContentLoaded', fetchData);
		function fetchData() {
				fetch(`/marketCards?page=${currentPage}&filter=${encodeURIComponent(filter)}&sort=${encodeURIComponent(`card_id.${sortBy}`)}`)
						.then(response => response.json())
						.then(data => displayData(data))
						.catch(error => console.error('Error fetching data:', error));
		}
		function displayData(data) {
				const dataContainer = document.getElementById('marketCards');
				
				data.forEach(item => {
						item["card_id"].forEach(it => {

							const user_id = document.createElement('p');
						user_id.textContent = `User_id: ${item["user_id"]}`;

							const div = document.createElement('div');
							div.classList.add('card');

							const card_id = document.createElement('p');
							card_id.textContent = `Card_id: ${it["card_id"]}`;

							const name = document.createElement('p');
							name.textContent = `Name: ${it["name"]}`;

							const nationality = document.createElement('p');
							nationality.textContent = `Nationality: ${it["nationality"]}`;

							const club = document.createElement('p');
							club.textContent = `Club: ${it["club"]}`;

							const position = document.createElement('p');
							position.textContent = `Position: ${it["position"]}`;
							
							div.appendChild(user_id);
							div.appendChild(card_id);
							div.appendChild(name);
							div.appendChild(club);
							div.appendChild(nationality);
							div.appendChild(position);
							dataContainer.appendChild(div);
						});
				});
		}
		// filtering
		document.getElementById("filterForm").addEventListener("submit", function(event){
			event.preventDefault();
			filter = document.getElementById('positionFilter').value;
			if (filter) {
				currentPage = 1
				page.innerHTML = currentPage;
				document.getElementById('prevPage').disabled = currentPage === 1;
				fetch(`/marketCards?page=${currentPage}&filter=${encodeURIComponent(filter)}&sort=${encodeURIComponent(`card_id.${sortBy}`)}`, {
            method: 'GET',
        })
        .then(response => response.json())
        .then(data => {
						var myDiv = document.getElementById('marketCards');
        		myDiv.innerHTML = '';
            displayData(data)
        })
        .catch(error => {
            console.error('Ошибка отправки данных:', error);
        });
      } else {
            alert('Please select a position before submitting.');
        }
		})
		// sorting
		document.getElementById("sortForm").addEventListener("submit", function(event){
			event.preventDefault();
			sortBy = document.getElementById('sortCards').value;
			filter = document.getElementById('positionFilter').value;
			if (sortBy) {
				currentPage = 1
				page.innerHTML = currentPage;
				document.getElementById('prevPage').disabled = currentPage === 1;
				fetch(`/marketCards?page=${currentPage}&filter=${encodeURIComponent(filter)}&sort=${encodeURIComponent(`card_id.${sortBy}`)}`, {
            method: 'GET',
        })
        .then(response => response.json())
        .then(data => {
						var myDiv = document.getElementById('marketCards');
        		myDiv.innerHTML = '';
            displayData(data)
        })
        .catch(error => {
            console.error('Ошибка отправки данных:', error);
        });
      } else {
            alert('Please select a position before submitting.');
        }
		})
		// pagination
		document.getElementById("nextPage").addEventListener("click", function(){
			currentPage += 1
			page.innerHTML = currentPage;
			fetch(`/marketCards?page=${currentPage}&filter=${encodeURIComponent(filter)}&sort=${encodeURIComponent(`card_id.${sortBy}`)}`, {
        method: 'GET',
      })
				.then(response => response.json())
				.then(data =>{
					var myDiv = document.getElementById('marketCards');
        	myDiv.innerHTML = '';
				 	displayData(data)})
				.catch(error => console.error('Error fetching data:', error));
			document.getElementById('prevPage').disabled = currentPage === 1;
			if (currentPage != 1) {
				document.getElementById('prevPage').disabled = false;
			}
			document.getElementById('nextPage').disabled = currentPage === 8;
			if (currentPage != 8) {
				document.getElementById('nextPage').disabled = false;
			}
		})
		document.getElementById("prevPage").addEventListener("click", function(){
			currentPage -= 1;
			page.innerHTML = currentPage;
			fetch(`/marketCards?page=${currentPage}&filter=${encodeURIComponent(filter)}&sort=${encodeURIComponent(`card_id.${sortBy}`)}`, {
        method: 'GET',
      })
				.then(response => response.json())
				.then(data =>{
					var myDiv = document.getElementById('marketCards');
        	myDiv.innerHTML = '';
				 	displayData(data)})
				.catch(error => console.error('Error fetching data:', error));
			document.getElementById('prevPage').disabled = currentPage === 1;
			if (currentPage != 1) {
				document.getElementById('prevPage').disabled = false;
			}
			document.getElementById('nextPage').disabled = currentPage === 8;
			if (currentPage != 8) {
				document.getElementById('nextPage').disabled = false;
			}
		})
	</script>
</body>
</html>